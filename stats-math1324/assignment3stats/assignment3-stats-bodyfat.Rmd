---
title: Predicting Body Fat Percentage - MATH1324 Introduction to Statistics Assignment
  3
author: "Phil Steinke s3725547"
output:
  html_notebook:
    code_folding: none
    fig_caption: yes
    fig_width: 8
    highlight: espresso
    theme: paper
editor_options:
  chunk_output_type: inline
---

What's involved

Hypothesis
Null hypothesis
compare two things to see if there's a link
TODO: update this output before printing
```{r load packages and data, message=F, warning=FALSE, include=FALSE, paged.print=FALSE}
packagesList <- c("readr", "base", "readxl", "dplyr", "mosaic", "gridExtra", "latticeExtra", "epitools", "qqplotr", "car", "ggplot2", "kableExtra", "mosaic", "psychometric", "psych", "Hmisc", "corrplot")
lapply(packagesList, require, character.only = TRUE)
setwd("~/code/tldr/data-science/stats-math1324/assignment3stats")
body <- read_excel("data/Body (2) Assignment 3 data.xlsx", sheet = "Body (2) Assignment 3 data") %>% as.data.frame()
body$Sex <- factor(body$Sex, levels = c(1, 0), labels = c("Male", "Female")) # Sex: “1” for male “0” for female
bodyCorrelation <- body %>% .[-c(1, 3:5, length(.))] # remove sex and case number for correlation. ONLY RUN ONCE!
```

#### Overview
The Body(2).csv dataset is posted on the Assignment 3 website. It contains the percentage of body fat, age, weight, height, and ten body circumference measurements (e.g., abdomen) for a sample of 252 men and women.  Body fat, as measured using the Brozek method, is estimated through a time consuming underwater weighing technique to measure a person's density.
- **Investigators want to determine if a general, easy to determine, body circumference measurement could be used as a general indicator for body fat percentage**.
- **If so, the investigators want to establish a formula that can convert a body circumference measurement to a predicted body fat percentage **
- **and also understand how well this prediction will hold.**
- (original source: [JSE-DA]).



&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&

## Regression modelling

### 4.0 Find the single best predictor of body fat percentage (Brozek method) using the body circumference data.

The best factor for body fat percentage via the Brozek method is Abdomen with an .81*** Pearson correlation
```{r name of package, echo=TRUE}
bodyCorrelationRcorrUnordered <- bodyCorrelation %>% as.matrix() %>% rcorr(type = "pearson") # Unordered bivariate

# Order our factors by Pearson correlation with with BFP_Brozek
bodyCorrelationFactorOrdered <- bodyCorrelationRcorrUnordered$r %>% as.data.frame() %>% .[1] %>% order(decreasing = T)
bodyCorrelation <- bodyCorrelation[bodyCorrelationFactorOrdered] # TODO: refactor this if I don't need bodyCorrelation
bodyCorrelationOrderedByPearson <- bodyCorrelation %>% as.matrix() %>% rcorr(type = "pearson") # Ordered R Correlation

#bodyCorrelationOrderedByPearson %>% colnames() # <- Pearson correlation in order
bodyCorrelationOrderedByPearson$r %>% corrplot(method = "circle", type = "upper", tl.col = "darkblue", tl.srt = 45,  p.mat=bodyCorrelationOrderedByPearson$p, sig.level = 1, insig = "blank")
# Showing body
pairs.panels(bodyCorrelation[1:8], method = "pearson", hist.col = "#00AFBB", density = T, ellipses = F, cor = T, ci = T, digits = 2, rug = F, breaks = 20, stars = F, show.points=F)
```
<!-- ```{r message=TRUE, warning=TRUE, include=FALSE, warnings=0}
``` -->

#### The actual question:

#### 4.1 Write a report that explains your method for identifying the single best predictor.

#### 4.2 Use the best predictor to determine a model that can convert a person’s body circumference measurement to an estimated body fat percentage.

#### 4.3 Ensure you test the model parameters and any assumptions.

```{r}

bodyAbdomenMaxModel <- lm(Abdomen ~ BFP_Brozek, data = body)
msummary(bodyAbdomenMaxModel)
```

intercept ɑ is 71.11688
slope β is 1.13204
P- value to test if ɑ =0.0 is <2e-16***

P-value to test if β =0.0 <2e-16 ***
H<sub>0</sub>: β = 0
H<sub>A/sub>: β ≠ 0

H<sub>0</sub>: The data do not fit the linear regression model
H<sub>A/sub>: The data fit the linear regression model

#### Normal plot of residuals
```{r}
qqPlot(body$BFP_Brozek, dist = "norm") # Check normality if required # gives a weird answer
```

#### Testing Assumption of Homoscedasticity
```{r}
mplot(bodyAbdomenMaxModel, 1)
```




```{r}
xyplot(Abdomen ~ BFP_Brozek, data = body, ylab = "Abdomen", xlab = "BFP_Brozek", panel=panel.lmbands)

```


```{r}
# From class

F-statistic: 489.9 on 1 and 250 DF,  p-value: < 2.2e-16
> pf(FStatistic, lowerDF, upperDF, )
pf(489.9,1,250,lower.tail = FALSE, ) # 7.71020869865819e-61

p < confidence

p (7.71020869865819e-61) is less than the  Confidence Level

```
TODO: is it definitely lower tail false?

```{r}
confint(bodyAbdomenMaxModel, level = .99)
```

### Confidence Interval

#### Test Intercept (α)

H<sub>0</sub>: α = 0
H<sub>a</sub>: α ≠ 0

The 99% Confidence Interval (CI) for α is [68.4010649, 73.832686]
H<sub>0</sub>: α = 0 is not captured between this interval, so we reject H<sub>0</sub>.

#### Testing the Slope (β)

H<sub>0</sub>: β = 0
H<sub>A/sub>: β ≠ 0

The 99% Confidence Interval (CI) for β is [0.9992825, 1.264792]
H<sub>0</sub>: β = 0 is not captured between this interval, so we reject H<sub>0</sub>.

```{r}
coef(summary(bodyAbdomenMaxModel))
```

#### 4.4 Critique the predictive ability of the model and

#### 4.5 Draw an overall conclusion to help the investigators


- maybe do the pearson correlation first to see which has the strongest linear relationship and then do the
- SLR testing?

STEPS FOR GETTING IT DONESKY Module 9
Regression, y = ɑ + ɓx
Test for a significant relationship between y and x
Null: no relationship
Alternate: is a relationship
Look at p value for F statistic
Small p, reject null
Describe strength of relationship
Look at R value
R may be negative or positive
R > 0.75 – yes there is a strong relationship
ɓ = slope
Can be positive or negative
Change in y per unit x
ɑ = significance in model
ɑ = 0 vs ɑ ≠ 0
Will be given p value in R
Your residual must be normal
Mean = 0
Variance = σ2

H<sub>0</sub>: The data does not fit to linear regression model.
H<sub>a</sub>: The data fits to linear regression model.
We test the overall model using F-test.
Assumptions:
Independence (check research design)
Linearity(Check scatter plot)
Normality of residuals(check after model is fitted)
Homoscedasticity (check after model is fitted)
Decision Rules:
Reject H<sub>0</sub> if P-value for F statistics < ɑ.







[JSE-DA]: http://www.amstat.org/publications/jse/jse_data_archive.htm


```{r}
save.image()
rm(list = ls())
```
(no paired t-test)

&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
## The Assignment

# 1. two-sample t-test - Test whether the mean body fat percentage for males and females are the same

**Hypothesis for testing mean of two populations:**
H<sub>0</sub>: μ1 -μ2 = 0.0
H<sub>a</sub>: μ1 -μ2 ≠ 0.0


```{r}
favstats(~ BFP_Brozek | Sex, data = body) %>% kable("html") %>% kable_styling(full_width = F, bootstrap_options = "striped")
```
#### Test the assumption of normality
```{r}
qqPlot(BFP_Brozek ~ Sex, data = body, dist = "norm") # Check normality if required # gives a weird answer
```

Homogeneity Levene’s test
```{r}
leveneTest(BFP_Brozek ~ Sex, data = body)
```
TODO: add hypothesis test for Levene test

We assume that
.13 > .05 (significance level alpha)
therefore don't reject

Output:

My Notes:
The p-value for the Levene's test of equal variance for body weight between males and females was p = 0.1395

```{r}
# class t.test(Body_temp~ Gender, data = Body_temp,var.equal=FALSE,alternative="two.sided")
t.test(BFP_Brozek ~ Sex, data = body, var.equal = T, alternative = "two.sided") # Works
```
-> fail reject

# 2. Confidence Interval - Module 6
Estimate the 99% confidence interval for the mean body fat percentage in the population.
```{r}
confint(t.test(~ BFP_Brozek, data = body), conf.level = 0.99)

boxplot(body$BFP_Brozek, ylab = "The label goes here") # TODO:
```
```{r}

# TODO:
# from plot cheatsheet https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf
# http://ggplot2.tidyverse.org/reference/
# https://rpubs.com/hadley/ggplot2-layers
# f + geom_dotplot(binaxis = "y", stackdir =
# "center"), x, y, alpha, color, fill, group
# f + geom_violin(scale = "area"), x, y, alpha, color, fill, group, linetype, size, weight
```

- ? We could be testing for normal standard distribution

1.
```{r}
favstats(~ BFP_Brozek | Sex, data = body)
histogram(~ BFP_Brozek | Sex, data = body, layout = c(1, 2))
```
Output:
     Sex min     Q1 median    Q3  max     mean       sd   n missing
1   Male 4.6 13.100  19.05 24.05 38.2 18.66000 7.348052 160       0
2 Female 0.0 12.775  18.75 25.35 45.1 19.42283 8.425499  92       0


???
```{r}
body$BFP_Brozek %>% mean() # why?
```
Output:
[1] 18.93849

???
Output
  mean of x    lower    upper level
1  19.42283 17.11176 21.73389  0.99

```{r}
confint(
  t.test(
    ~ BFP_Brozek,
    data =
      subset(
        body,
        subset = (Sex == "Male")
      ),
    conf.level = 0.99
  )
)
```
  mean of x   lower   upper level
1     18.66 17.1455 20.1745  0.99

```{r}
binom.approx(44, 109, conf.level = 0.99)
```
output:
   x   n proportion    lower     upper conf.level
1 44 109  0.4036697 0.282621 0.5247185       0.99

### Is there any assumption for the body fat percentage distribution that we need to investigate?

How it's measured.
ie. circumference, electronics, submersion.

### Explain your reason (s).
-
-
-

# 3. One sample T Test - One tail
#### Researchers believe that average body fat percentage is less than 12.5. Test this claim.

H<sub>0</sub>: μ = 12.5
H<sub>a</sub>: μ < 12.5

```{r}
# TODO; test assumption of normality
t.test(~ BFP_Brozek, data = body, mu = 12.5, alternative = "less")
# todo add Confidence level
favstats(~ BFP_Brozek, data = body)
filter(.data = body, BFP_Brozek == 0)
# P value = 1 !!!
```

We could do a further test by
- a two tailed test
- the Ha being mu > 12.5
- testing a different mu based on further research


if we changed it to t.test(~ BFP_Brozek, data=body, mu = 12.5, alternative = "greater")
it works


Out:
data:  BFP_Brozek
t = 13.187, df = 251, p-value = 1
alternative hypothesis: true mean is less than 12.5
95 percent confidence interval:
     -Inf 19.74458
sample estimates:
mean of x
 18.93849

_Write down your null and alternative hypothesis clearly, express your conclusion in words and provide your reason(s) for your final conclusion._

### null hypothesis

### alternative hypothesis

### Conclusion

### Reasons

-
-
-
