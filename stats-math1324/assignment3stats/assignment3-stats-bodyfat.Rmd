---
title: "Predicting Body Fat Percentage - MATH1324 Introduction to Statistics Assignment 3"
author: "Phil Steinke s3725547"
---
output:
  html_notebook:
    code_folding: none
    number_sections: yes
    theme: flatly
editor_options:
  chunk_output_type: inline

What's involved

Hypothesis
Null hypothesis
compare two things to see if there's a link

```{r, echo = TRUE, message=FALSE, warnings=0}
packagesList <- c("readr", "base", "readxl", "dplyr", "mosaic", "gridExtra", "latticeExtra", "epitools", "qqplotr", "car", "ggplot2", "kableExtra", "mosaic", "psychometric", "psych", "Hmisc")
lapply(packagesList, require, character.only = TRUE)
setwd("~/code/tldr/data-science/stats-math1324/assignment3stats")
body <- read_excel("data/Body (2) Assignment 3 data.xlsx", sheet = "Body (2) Assignment 3 data") %>% as.data.frame()
body$Sex <- factor(body$Sex, levels = c(1,0), labels = c("Male","Female")) #Sex: “1” for male and “0” for female
```

#### Overview
The Body(2).csv dataset is posted on the Assignment 3 website. It contains the percentage of body fat, age, weight, height, and ten body circumference measurements (e.g., abdomen) for a sample of 252 men and women.  Body fat, as measured using the Brozek method, is estimated through a time consuming underwater weighing technique to measure a person's density.
- **Investigators want to determine if a general, easy to determine, body circumference measurement could be used as a general indicator for body fat percentage**.
- **If so, the investigators want to establish a formula that can convert a body circumference measurement to a predicted body fat percentage **
- **and also understand how well this prediction will hold.**
- (original source: [JSE-DA]).


## The Assignment

### 1. two-sample t-test - Test whether the mean body fat percentage for males and females are the same

**Hypothesis for testing mean of two populations:**
H<sub>0</sub>: μ1 -μ2 = 0.0
H<sub>a</sub>: μ1 -μ2 ≠ 0.0

```{r}
# body %>% tail() %>% kable("html")
favstats(~ BFP_Brozek | Sex, data = body)
#%>% kable("html")
```
**Test the assumption of normality:**
```{r}
# TODO: titles
qqPlot(body$BFP_Brozek, dist="norm") #Check normality if required # gives a weird answer
qqPlot(BFP_Brozek ~ Sex, data = body, dist="norm") #Check normality if required # gives a weird answer
```

Homogeneity Levene’s test
```{r}
leveneTest(BFP_Brozek ~ Sex, data = body)
```
Output:

My Notes:
The p-value for the Levene's test of equal variance for body weight between males and females was p = 0.1395

```{r}
# class t.test(Body_temp~ Gender, data = Body_temp,var.equal=FALSE,alternative="two.sided")
t.test(BFP_Brozek~ Sex, data = body,var.equal=FALSE,alternative="two.sided") # Works
```
Output:

	Welch Two Sample t-test

data:  BFP_Brozek by Sex
t = -0.72434, df = 169.45, p-value = 0.4699
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -2.841769  1.316117
sample estimates:
  mean in group Male mean in group Female
            18.66000             19.42283

#### 2. Confidence Interval - Module 6
Estimate the 99% confidence interval for the mean body fat percentage in the population.
```{r}
confint(
  t.test(
    ~ BFP_Brozek,
    data = body
    ),
    conf.level=0.99)
# %>% kable("html")

boxplot(body$BFP_Brozek, ylab = "The label goes here") # TODO:


```
Output:
  mean of x    lower   upper level
1  18.93849 17.97689 19.9001  0.95

## Male
```{r}
confint(
  t.test(
    ~ BFP_Brozek,
    data =
      subset(
        body,
        subset=(Sex=="Male")),
      conf.level=0.99))
```

```{r}
confint(
  t.test(
    ~ BFP_Brozek,
    data =
      subset(
        body,
        subset=(Sex=="Female")),
      conf.level=0.99))
```

```{r}
cis<-data.frame(Group = c("Male","Female"),
                Means = c(18.66, 19.42283),
                LB = c(17.15, 17.11),
                UB = c(20.17, 21.73))
# TODO:
p <- ggplot(body, aes(Group, y = BFP_Brozek)) +
  geom_dotplot(binaxis = "y", stackdir = "center",alpha = 0.3) +

  stat_summary(data = cis, geom = "point", fun.y = "mean", colour = "red", size = 4)



+  layer(data = cis,mapping = aes(x = Group, y = Means),
        geom = "point", size = 4, color = "red")
# TODO:
+
  stat_function(data = cis,mapping = aes(x = Group, y = Means, ymin = LB, ymax = UB),
        geom = "errorbar", size = 1, color = "red", width = 0.2)
p # layer or stat_function

# TODO:
# from plot cheatsheet https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf
# http://ggplot2.tidyverse.org/reference/
# https://rpubs.com/hadley/ggplot2-layers
# f + geom_dotplot(binaxis = "y", stackdir =
# "center"), x, y, alpha, color, fill, group
# f + geom_violin(scale = "area"), x, y, alpha, color, fill, group, linetype, size, weight

```

- ? We could be testing for normal standard distribution

1.
```{r}
favstats(~BFP_Brozek | Sex, data=body)
histogram(~BFP_Brozek | Sex, data=body,layout=c(1,2))
```
Output:
     Sex min     Q1 median    Q3  max     mean       sd   n missing
1   Male 4.6 13.100  19.05 24.05 38.2 18.66000 7.348052 160       0
2 Female 0.0 12.775  18.75 25.35 45.1 19.42283 8.425499  92       0


???
```{r}
body$BFP_Brozek %>% mean() # why?
```
Output:
[1] 18.93849

???
Output
  mean of x    lower    upper level
1  19.42283 17.11176 21.73389  0.99

```{r}
confint(
  t.test(
    ~ BFP_Brozek,
    data =
      subset(
        body,
        subset=(Sex=="Male")),
      conf.level=0.99))
```
  mean of x   lower   upper level
1     18.66 17.1455 20.1745  0.99

```{r}
binom.approx(44, 109, conf.level = 0.99)
```
output:
   x   n proportion    lower     upper conf.level
1 44 109  0.4036697 0.282621 0.5247185       0.99

### Is there any assumption for the body fat percentage distribution that we need to investigate?

How it's measured.
ie. circumference, electronics, submersion.

### Explain your reason (s).
-
-
-

# 1 sample T Test - 1 tail
#### 3. - Researchers believe that average body fat percentage is less than 12.5. Test this claim.

```{r}
# TODO; test assumption of normality
t.test(~ BFP_Brozek, data=body, mu = 12.5, alternative="less")

# P value = 1 !!!

```
Out:
data:  BFP_Brozek
t = 13.187, df = 251, p-value = 1
alternative hypothesis: true mean is less than 12.5
95 percent confidence interval:
     -Inf 19.74458
sample estimates:
mean of x
 18.93849

_Write down your null and alternative hypothesis clearly, express your conclusion in words and provide your reason(s) for your final conclusion._

### null hypothesis

### alternative hypothesis

### Conclusion

### Reasons

-
-
-

## Regression modeling
### 4. Find the single best predictor of body fat percentage (Brozek method) using the body circumference data.
- maybe do the pearson correlation first to see which has the strongest linear relationship and then do the
- SLR testing?

# TODO:
 H0: The data does not fit to linear regression model.
 HA: The data fits to linear regression model.
 We test the overall model using F-test.
 Assumptions:
 Independence (check research design)
 Linearity(Check scatter plot)
 Normality of residuals(check after model is fitted)
 Homoscedasticity (check after model is fitted)
 Decision Rules:
 Reject H0 if P-value for F statistics < ɑ.

```{r echo=TRUE}
getCorrelation <- function(.) {
  orderedCorrelation <- .[, lapply(., is.numeric) %>% unlist()] %>% rcorr( type = "pearson") %>% round(digits = 2) %>% as.data.frame()
} 
bodyCorrelations <- body %>% getCorrelation()
bodyCorrelations
# orderedBodyCorrelations <- order(-bodyCorrelations$BFP_Brozek)
orderedCorrelation <- 
  bodyCorrelations[,1:19] %>% 
  .[orderedBodyCorrelations, orderedBodyCorrelations]
orderedCorrelation # TODO: Problem that the correlation numbers don't come out right

# Selecting plots with a pearson correlation > 0.5
pairs.panels(orderedCorrelation[,c(1,3:12)], method="pearson", hist.col="#00AFBB", density=T, ellipses=T, cor =T, ci=T)
```
- The pearson correlating factors to BFP_Brozek in order are 
Abdomen, Adiposity_index, Chest, Hip, Weight, Thigh and so on

```{r}


```

```{r}
#Class:

```

```{r}

xyplot(Abdomen ~ BFP_Brozek, data = body, ylab ="Abdoment",xlab="BFP_Brozek")


```


#### Write a report that explains your method for identifying the single best predictor.

#### Use the best predictor to determine a model that can convert a person’s body circumference measurement to an estimated body fat percentage.

#### Ensure you test the model parameters and any assumptions.

#### Critique the predictive ability of the model and

#### Draw an overall conclusion to help the investigators

[JSE-DA]: http://www.amstat.org/publications/jse/jse_data_archive.htm


```{r}
save.image()
rm(list=ls())
```
(no paired t-test)
